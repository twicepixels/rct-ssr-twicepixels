'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getStyleClasses = exports.getStyleImportNodeData = exports.getPropertyName = undefined;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _fp = require('lodash/fp');

var _fp2 = _interopRequireDefault(_fp);

var _gonzales = require('./gonzales');

var _gonzales2 = _interopRequireDefault(_gonzales);

var _traversalUtils = require('./traversalUtils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var styleExtensionRegex = /\.(s?css|less)$/;

var getPropertyName = exports.getPropertyName = function getPropertyName(node) {
  if (node.computed) {
    /*
       square braces eg s['header']
       we won't use node.property.name because it is for cases like
       s[abc] where abc is a variable
     */
    return node.property.value;
  }

  return node.property.name; /* dot notation, eg s.header */
};

var getStyleImportNodeData = exports.getStyleImportNodeData = function getStyleImportNodeData(node) {
  // path from which it was imported
  var styleFilePath = _fp2.default.get('source.value')(node);

  if (styleFilePath && styleExtensionRegex.test(styleFilePath)) {
    var importNode = _fp2.default.compose(_fp2.default.find({ type: 'ImportDefaultSpecifier' }), _fp2.default.get('specifiers'))(node);

    // the default imported name
    var importName = _fp2.default.get('local.name')(importNode);

    if (importName) {
      // it had a default import
      return { importName: importName, styleFilePath: styleFilePath, importNode: importNode };
    }
  }
};

var getStyleClasses = exports.getStyleClasses = function getStyleClasses(filePath) {
  try {
    // check if file exists
    _fs2.default.statSync(filePath);
  } catch (e) {
    return {}; // user will get error like class 'x' not found
  }

  var fileContent = _fs2.default.readFileSync(filePath);

  var syntax = _path2.default.extname(filePath).slice(1); // remove leading .

  var ast = _gonzales2.default.parse(fileContent.toString(), { syntax: syntax });

  if (!ast) {
    // it will be silent and will not show any error
    return null;
  }

  /*
     mutates ast by removing :global scopes
   */
  (0, _traversalUtils.eliminateGlobals)(ast);

  var classesMap = (0, _traversalUtils.getRegularClassesMap)(ast);
  var composedClassesMap = (0, _traversalUtils.getComposesClassesMap)(ast);
  var extendClassesMap = (0, _traversalUtils.getExtendClassesMap)(ast);

  return _extends({}, classesMap, composedClassesMap, extendClassesMap);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9jb3JlL2luZGV4LmpzIl0sIm5hbWVzIjpbInN0eWxlRXh0ZW5zaW9uUmVnZXgiLCJnZXRQcm9wZXJ0eU5hbWUiLCJub2RlIiwiY29tcHV0ZWQiLCJwcm9wZXJ0eSIsInZhbHVlIiwibmFtZSIsImdldFN0eWxlSW1wb3J0Tm9kZURhdGEiLCJzdHlsZUZpbGVQYXRoIiwiZ2V0IiwidGVzdCIsImltcG9ydE5vZGUiLCJjb21wb3NlIiwiZmluZCIsInR5cGUiLCJpbXBvcnROYW1lIiwiZ2V0U3R5bGVDbGFzc2VzIiwiZmlsZVBhdGgiLCJzdGF0U3luYyIsImUiLCJmaWxlQ29udGVudCIsInJlYWRGaWxlU3luYyIsInN5bnRheCIsImV4dG5hbWUiLCJzbGljZSIsImFzdCIsInBhcnNlIiwidG9TdHJpbmciLCJjbGFzc2VzTWFwIiwiY29tcG9zZWRDbGFzc2VzTWFwIiwiZXh0ZW5kQ2xhc3Nlc01hcCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFJQTs7OztBQU9BLElBQU1BLHNCQUFzQixpQkFBNUI7O0FBRU8sSUFBTUMsNENBQWtCLFNBQWxCQSxlQUFrQixDQUFDQyxJQUFELEVBQTJCO0FBQ3hELE1BQUlBLEtBQUtDLFFBQVQsRUFBbUI7QUFDakI7Ozs7O0FBS0EsV0FBT0QsS0FBS0UsUUFBTCxDQUFjQyxLQUFyQjtBQUNEOztBQUVELFNBQU9ILEtBQUtFLFFBQUwsQ0FBY0UsSUFBckIsQ0FWd0QsQ0FVNUI7QUFDN0IsQ0FYTTs7QUFhQSxJQUFNQywwREFBeUIsU0FBekJBLHNCQUF5QixDQUFDTCxJQUFELEVBQTJCO0FBQy9EO0FBQ0EsTUFBTU0sZ0JBQWdCLGFBQUdDLEdBQUgsQ0FBTyxjQUFQLEVBQXVCUCxJQUF2QixDQUF0Qjs7QUFFQSxNQUFJTSxpQkFBaUJSLG9CQUFvQlUsSUFBcEIsQ0FBeUJGLGFBQXpCLENBQXJCLEVBQThEO0FBQzVELFFBQU1HLGFBQWEsYUFBR0MsT0FBSCxDQUNqQixhQUFHQyxJQUFILENBQVEsRUFBRUMsTUFBTSx3QkFBUixFQUFSLENBRGlCLEVBRWpCLGFBQUdMLEdBQUgsQ0FBTyxZQUFQLENBRmlCLEVBR2pCUCxJQUhpQixDQUFuQjs7QUFLQTtBQUNBLFFBQU1hLGFBQWEsYUFBR04sR0FBSCxDQUFPLFlBQVAsRUFBcUJFLFVBQXJCLENBQW5COztBQUVBLFFBQUlJLFVBQUosRUFBZ0I7QUFBRTtBQUNoQixhQUFPLEVBQUVBLHNCQUFGLEVBQWNQLDRCQUFkLEVBQTZCRyxzQkFBN0IsRUFBUDtBQUNEO0FBQ0Y7QUFDRixDQWpCTTs7QUFtQkEsSUFBTUssNENBQWtCLFNBQWxCQSxlQUFrQixDQUFDQyxRQUFELEVBQStCO0FBQzVELE1BQUk7QUFDRjtBQUNBLGlCQUFHQyxRQUFILENBQVlELFFBQVo7QUFDRCxHQUhELENBR0UsT0FBT0UsQ0FBUCxFQUFVO0FBQ1YsV0FBTyxFQUFQLENBRFUsQ0FDQztBQUNaOztBQUVELE1BQU1DLGNBQWMsYUFBR0MsWUFBSCxDQUFnQkosUUFBaEIsQ0FBcEI7O0FBRUEsTUFBTUssU0FBUyxlQUFLQyxPQUFMLENBQWFOLFFBQWIsRUFBdUJPLEtBQXZCLENBQTZCLENBQTdCLENBQWYsQ0FWNEQsQ0FVWjs7QUFFaEQsTUFBTUMsTUFBTSxtQkFBU0MsS0FBVCxDQUFlTixZQUFZTyxRQUFaLEVBQWYsRUFBdUMsRUFBRUwsY0FBRixFQUF2QyxDQUFaOztBQUVBLE1BQUksQ0FBQ0csR0FBTCxFQUFVO0FBQ1I7QUFDQSxXQUFPLElBQVA7QUFDRDs7QUFFRDs7O0FBR0Esd0NBQWlCQSxHQUFqQjs7QUFFQSxNQUFNRyxhQUFhLDBDQUFxQkgsR0FBckIsQ0FBbkI7QUFDQSxNQUFNSSxxQkFBcUIsMkNBQXNCSixHQUF0QixDQUEzQjtBQUNBLE1BQU1LLG1CQUFtQix5Q0FBb0JMLEdBQXBCLENBQXpCOztBQUVBLHNCQUFZRyxVQUFaLEVBQTJCQyxrQkFBM0IsRUFBa0RDLGdCQUFsRDtBQUNELENBN0JNIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcblxuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGZwIGZyb20gJ2xvZGFzaC9mcCc7XG5pbXBvcnQgZ29uemFsZXMgZnJvbSAnLi9nb256YWxlcyc7XG5cbmltcG9ydCB0eXBlIHsgSnNOb2RlIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG5pbXBvcnQge1xuICBnZXRSZWd1bGFyQ2xhc3Nlc01hcCxcbiAgZ2V0Q29tcG9zZXNDbGFzc2VzTWFwLFxuICBnZXRFeHRlbmRDbGFzc2VzTWFwLFxuICBlbGltaW5hdGVHbG9iYWxzLFxufSBmcm9tICcuL3RyYXZlcnNhbFV0aWxzJztcblxuY29uc3Qgc3R5bGVFeHRlbnNpb25SZWdleCA9IC9cXC4ocz9jc3N8bGVzcykkLztcblxuZXhwb3J0IGNvbnN0IGdldFByb3BlcnR5TmFtZSA9IChub2RlOiBKc05vZGUpOiA/c3RyaW5nID0+IHtcbiAgaWYgKG5vZGUuY29tcHV0ZWQpIHtcbiAgICAvKlxuICAgICAgIHNxdWFyZSBicmFjZXMgZWcgc1snaGVhZGVyJ11cbiAgICAgICB3ZSB3b24ndCB1c2Ugbm9kZS5wcm9wZXJ0eS5uYW1lIGJlY2F1c2UgaXQgaXMgZm9yIGNhc2VzIGxpa2VcbiAgICAgICBzW2FiY10gd2hlcmUgYWJjIGlzIGEgdmFyaWFibGVcbiAgICAgKi9cbiAgICByZXR1cm4gbm9kZS5wcm9wZXJ0eS52YWx1ZTtcbiAgfVxuXG4gIHJldHVybiBub2RlLnByb3BlcnR5Lm5hbWU7ICAvKiBkb3Qgbm90YXRpb24sIGVnIHMuaGVhZGVyICovXG59O1xuXG5leHBvcnQgY29uc3QgZ2V0U3R5bGVJbXBvcnROb2RlRGF0YSA9IChub2RlOiBKc05vZGUpOiA/T2JqZWN0ID0+IHtcbiAgLy8gcGF0aCBmcm9tIHdoaWNoIGl0IHdhcyBpbXBvcnRlZFxuICBjb25zdCBzdHlsZUZpbGVQYXRoID0gZnAuZ2V0KCdzb3VyY2UudmFsdWUnKShub2RlKTtcblxuICBpZiAoc3R5bGVGaWxlUGF0aCAmJiBzdHlsZUV4dGVuc2lvblJlZ2V4LnRlc3Qoc3R5bGVGaWxlUGF0aCkpIHtcbiAgICBjb25zdCBpbXBvcnROb2RlID0gZnAuY29tcG9zZShcbiAgICAgIGZwLmZpbmQoeyB0eXBlOiAnSW1wb3J0RGVmYXVsdFNwZWNpZmllcicgfSksXG4gICAgICBmcC5nZXQoJ3NwZWNpZmllcnMnKSxcbiAgICApKG5vZGUpO1xuXG4gICAgLy8gdGhlIGRlZmF1bHQgaW1wb3J0ZWQgbmFtZVxuICAgIGNvbnN0IGltcG9ydE5hbWUgPSBmcC5nZXQoJ2xvY2FsLm5hbWUnKShpbXBvcnROb2RlKTtcblxuICAgIGlmIChpbXBvcnROYW1lKSB7IC8vIGl0IGhhZCBhIGRlZmF1bHQgaW1wb3J0XG4gICAgICByZXR1cm4geyBpbXBvcnROYW1lLCBzdHlsZUZpbGVQYXRoLCBpbXBvcnROb2RlIH07XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0U3R5bGVDbGFzc2VzID0gKGZpbGVQYXRoOiBzdHJpbmcpOiA/T2JqZWN0ID0+IHtcbiAgdHJ5IHtcbiAgICAvLyBjaGVjayBpZiBmaWxlIGV4aXN0c1xuICAgIGZzLnN0YXRTeW5jKGZpbGVQYXRoKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiB7fTsgLy8gdXNlciB3aWxsIGdldCBlcnJvciBsaWtlIGNsYXNzICd4JyBub3QgZm91bmRcbiAgfVxuXG4gIGNvbnN0IGZpbGVDb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoKTtcblxuICBjb25zdCBzeW50YXggPSBwYXRoLmV4dG5hbWUoZmlsZVBhdGgpLnNsaWNlKDEpOyAvLyByZW1vdmUgbGVhZGluZyAuXG5cbiAgY29uc3QgYXN0ID0gZ29uemFsZXMucGFyc2UoZmlsZUNvbnRlbnQudG9TdHJpbmcoKSwgeyBzeW50YXggfSk7XG5cbiAgaWYgKCFhc3QpIHtcbiAgICAvLyBpdCB3aWxsIGJlIHNpbGVudCBhbmQgd2lsbCBub3Qgc2hvdyBhbnkgZXJyb3JcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qXG4gICAgIG11dGF0ZXMgYXN0IGJ5IHJlbW92aW5nIDpnbG9iYWwgc2NvcGVzXG4gICAqL1xuICBlbGltaW5hdGVHbG9iYWxzKGFzdCk7XG5cbiAgY29uc3QgY2xhc3Nlc01hcCA9IGdldFJlZ3VsYXJDbGFzc2VzTWFwKGFzdCk7XG4gIGNvbnN0IGNvbXBvc2VkQ2xhc3Nlc01hcCA9IGdldENvbXBvc2VzQ2xhc3Nlc01hcChhc3QpO1xuICBjb25zdCBleHRlbmRDbGFzc2VzTWFwID0gZ2V0RXh0ZW5kQ2xhc3Nlc01hcChhc3QpO1xuXG4gIHJldHVybiB7IC4uLmNsYXNzZXNNYXAsIC4uLmNvbXBvc2VkQ2xhc3Nlc01hcCwgLi4uZXh0ZW5kQ2xhc3Nlc01hcCB9O1xufTtcbiJdfQ==